<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login Admin | SI-TANGKAS</title>
    <link
      rel="icon"
      href="https://raw.githubusercontent.com/arnolduschatgpt/SITANGKAS/ec06e4f627f98e12b5d769445e27d9a16d1262c1/logo.png"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/flowbite@1.4.6/dist/flowbite.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
      body {
        font-family: "Inter", sans-serif;
      }
      .fade-in {
        animation: fadeIn 1s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .logo {
        transition: transform 0.4s ease, box-shadow 0.4s ease;
      }
      .logo:hover {
        transform: scale(1.08);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      }
    </style>

    <style>
      .swal2-popup.swal2-toast {
        font-size: 0.8rem !important;
        padding: 0.6rem 1rem !important;
        border-radius: 0.5rem !important;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
      }
      .swal2-toast .swal2-title {
        font-weight: 500 !important;
      }
    </style>
  </head>

  <body
    class="bg-gradient-to-br from-[#032F30] to-[#0A7075] min-h-screen flex items-center justify-center px-4"
  >
    <div
      id="toast-container"
      class="fixed top-4 right-4 z-50 flex flex-col space-y-3"
    ></div>
    <script>
      // üîí Cegah akses login jika sudah login & token masih aktif
      const token = localStorage.getItem("token");
      const expiredAt = localStorage.getItem("expiredAt");

      if (token && expiredAt) {
        const now = new Date();
        const expiry = new Date(expiredAt);

        if (!isNaN(expiry.getTime()) && expiry.getTime() > now.getTime()) {
          window.location.replace("dashboard.html");
        } else {
          // Token kadaluarsa ‚Üí hapus semua data login
          localStorage.clear();
        }
      }
    </script>

    <div
      class="bg-white rounded-2xl shadow-2xl p-8 md:p-10 max-w-md w-full fade-in border border-gray-100"
    >
      <div class="flex flex-col items-center justify-center mb-8">
        <img
          src="https://raw.githubusercontent.com/arnolduschatgpt/SITANGKAS/ec06e4f627f98e12b5d769445e27d9a16d1262c1/logo.png"
          alt="Logo SITANGKAS"
          class="w-24 h-24 object-contain logo"
        />
      </div>

      <h2 class="text-xl font-bold text-center text-[#032F30] mb-6">
        Login Administrator SI-TANGKAS
      </h2>

      <form id="loginForm" class="space-y-4">
        <div class="relative">
          <label
            for="username"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Username</label
          >
          <div
            class="flex items-center border border-gray-300 rounded-lg px-3 focus-within:ring-2 focus-within:ring-[#0C969C]"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 text-gray-400 mr-2"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M5.121 17.804A8 8 0 0112 15a8 8 0 016.879 2.804M12 11a4 4 0 100-8 4 4 0 000 8z"
              />
            </svg>
            <input
              type="text"
              id="username"
              class="w-full py-2 focus:outline-none"
              placeholder="Masukkan username"
            />
          </div>
        </div>

        <div class="relative">
          <label
            for="password"
            class="block text-sm font-medium text-gray-700 mb-1"
            >Password</label
          >
          <div
            class="flex items-center border border-gray-300 rounded-lg px-3 focus-within:ring-2 focus-within:ring-[#0C969C]"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              class="w-5 h-5 text-gray-400 mr-2"
              fill="none"
              viewBox="0 0 24 24"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 11c1.657 0 3 1.343 3 3v3H9v-3c0-1.657 1.343-3 3-3z"
              />
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M17 11V7a5 5 0 00-10 0v4"
              />
            </svg>
            <input
              type="password"
              id="password"
              class="w-full py-2 focus:outline-none"
              placeholder="Masukkan password"
            />
            <button
              type="button"
              id="togglePassword"
              class="focus:outline-none text-gray-400 hover:text-[#0C969C]"
            >
              <svg
                id="eyeIcon"
                xmlns="http://www.w3.org/2000/svg"
                class="w-5 h-5"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                />
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M2.458 12C3.732 7.943 7.523 5 12 5
                c4.477 0 8.268 2.943 9.542 7
                -1.274 4.057-5.065 7-9.542 7
                -4.477 0-8.268-2.943-9.542-7z"
                />
              </svg>
            </button>
          </div>
        </div>

        <button
          type="submit"
          class="w-full bg-[#0C969C] text-white font-semibold py-3 rounded-lg shadow-md hover:bg-[#0A7075] transition-all"
        >
          Masuk
        </button>
      </form>

      <div class="text-center mt-6">
        <a href="index.html" class="text-sm text-[#0C969C] hover:underline"
          >‚Üê Kembali ke Beranda</a
        >
      </div>
    </div>

    <script>
      // toggle password
      const togglePassword = document.getElementById("togglePassword");
      const passwordInput = document.getElementById("password");
      const eyeIcon = document.getElementById("eyeIcon");
      let visible = false;
      togglePassword.addEventListener("click", () => {
        visible = !visible;
        passwordInput.type = visible ? "text" : "password";
        eyeIcon.innerHTML = visible
          ? `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M13.875 18.825A10.05 10.05 0 0112 19c-4.477 0-8.268-2.943-9.542-7
            a9.97 9.97 0 013.406-5.018M9.88 9.88a3 3 0 104.24 4.24M3 3l18 18"/>`
          : `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M2.458 12C3.732 7.943 7.523 5 12 5
            c4.477 0 8.268 2.943 9.542 7
            -1.274 4.057-5.065 7-9.542 7
            -4.477 0-8.268-2.943-9.542-7z" />`;
      });
    </script>
  </body>

  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <script>
    const scriptURL =
      "https://script.google.com/macros/s/AKfycbx23Dz6zsW27FY71oe2cVTGl3NQ-el7P3M5kS0tU1C4WoehCAte2P6r0Yq5logmvfW9/exec";

    // üîπ Toast horizontal pakai html
    const Toast = Swal.mixin({
      toast: true,
      position: "top-end",
      showConfirmButton: false,
      timer: 2500,
      timerProgressBar: true,
      background: "white",
      color: "#333",
      width: "360px",
      padding: "0.5rem 1rem",
      iconColor: "#3085d6",
      customClass: {
        popup: "rounded-lg shadow-lg font-medium text-sm",
      },
      didOpen: (toast) => {
        toast.addEventListener("mouseenter", Swal.stopTimer);
        toast.addEventListener("mouseleave", Swal.resumeTimer);
      },
    });

    // üîπ Spinner keyframes (sekali saja)
    if (!document.getElementById("toast-spinner-style")) {
      const style = document.createElement("style");
      style.id = "toast-spinner-style";
      style.innerHTML = `
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  `;
      document.head.appendChild(style);
    }

    // üîπ Fungsi untuk menampilkan toast horizontal
    function showToast(type, message, iconColor = "#3085d6") {
      let iconSVG = "";
      switch (type) {
        case "success":
          iconSVG = `<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                   <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
                 </svg>`;
          break;
        case "error":
          iconSVG = `<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                   <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path>
                 </svg>`;
          break;
        case "warning":
          iconSVG = `<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                   <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v2m0 4h.01M5.07 19h13.86l-6.93-12z"></path>
                 </svg>`;
          break;
        case "info":
          iconSVG = `<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                   <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M12 20.5a8.5 8.5 0 100-17 8.5 8.5 0 000 17z"></path>
                 </svg>`;
          break;
      }

      Toast.fire({
        html: `
      <div style="
        display:flex;
        align-items:center;
        gap:8px;
        white-space: nowrap;
        overflow:hidden;
        text-overflow: ellipsis;
        color: inherit;
      ">
        ${iconSVG}
        <span style="white-space: nowrap; overflow:hidden; text-overflow:ellipsis;">${message}</span>
      </div>
    `,
        iconColor: iconColor,
      });
    }

    // üîπ Login form submit
    document
      .getElementById("loginForm")
      .addEventListener("submit", async (e) => {
        e.preventDefault();

        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();

        if (!username || !password) {
          showToast("warning", "Masukkan username & password dulu.");
          return;
        }

        // üîπ Loading toast horizontal
        const loadingToast = Swal.mixin({
          toast: true,
          position: "top-end",
          showConfirmButton: false,
          background: "white",
          color: "#333",
          width: "360px",
          padding: "0.5rem 1rem",
          customClass: {
            popup: "rounded-lg shadow-lg font-medium text-sm",
          },
          didOpen: (toast) => {
            toast.innerHTML = `
        <div style="
          display:flex; 
          align-items:center; 
          gap:8px; 
          white-space: nowrap; 
          overflow:hidden; 
          text-overflow: ellipsis;
        ">
          <div style="
            width:16px; height:16px; 
            border:2px solid #ccc; 
            border-top-color:#3085d6; 
            border-radius:50%; 
            animation:spin 0.8s linear infinite;
          "></div>
          <span style="white-space: nowrap; overflow:hidden; text-overflow:ellipsis; color:#555;">Memeriksa data...</span>
        </div>
      `;
          },
        });
        loadingToast.fire();

        try {
          const url = `${scriptURL}?username=${encodeURIComponent(
            username
          )}&password=${encodeURIComponent(password)}`;
          const response = await fetch(url);
          const result = await response.json();

          Swal.close(); // tutup loading

          if (!result.success) {
            showToast(
              "error",
              result.message || "Username atau password salah."
            );
            return;
          }

          // Simpan login
          localStorage.setItem("token", result.token);
          localStorage.setItem("expiredAt", result.expiredAt);
          localStorage.setItem("username", result.username);

          showToast("success", `Selamat datang, ${result.username}!`);

          setTimeout(() => {
            window.location.href = "dashboard.html";
          }, 1500);
        } catch (err) {
          Swal.close();
          console.error(err);
          showToast("error", "Tidak dapat menghubungi server. Coba lagi.");
        }
      });
  </script>
</html>
